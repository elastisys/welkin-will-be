
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Compliant Kubernetes is a Kubernetes distribution that reduces the burden for complying with Swedish Healthcare (Patientdatalagen), GDPR and ISO 27001.">
      
      
        <meta name="author" content="Elastisys AB">
      
      
        <link rel="canonical" href="https://elastisys.io/compliantkubernetes/operator-manual/disaster-recovery/">
      
      
        <link rel="prev" href="../user-alerts/">
      
      
        <link rel="next" href="../break-glass/">
      
      <link rel="icon" href="../../img/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.4">
    
    
      
        <title>Disaster Recovery - Elastisys Compliant Kubernetes</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.9c788c91.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
    
    
      <link rel="stylesheet" href="../../stylesheets/branding.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    

<!-- Matomo -->
<script>
  var _paq = window._paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://matomo.elastisys.com/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '2']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Matomo Code -->

    
    
<meta http-equiv="Content-Security-Policy" content="
  default-src 'self';
  style-src 'self' 'unsafe-inline';
  img-src 'self' data:;
  connect-src 'self' https://matomo.elastisys.com/;
  script-src 'self' 'unsafe-inline' https://matomo.elastisys.com/;
">

<!-- Disable localStorage, sessionStorage and cookies -->
<script>
if (window.localStorage) {
  window.localStorage.setItem = function() { };
  window.localStorage.clear();
}
if (window.sessionStorage) {
  window.sessionStorage.setItem = function() { }
  window.sessionStorage.clear();
}
if(!document.__defineGetter__) {
  Object.defineProperty(document, 'cookie', {
    get: function(){return ''},
    set: function(){return true},
  });
} else {
  document.__defineGetter__("cookie", function() { return '';} );
  document.__defineSetter__("cookie", function() {} );
}
</script>

  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="elastisys" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Elastisys Compliant Kubernetes" class="md-header__button md-logo" aria-label="Elastisys Compliant Kubernetes" data-md-component="logo">
      
  <img src="../../img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Elastisys Compliant Kubernetes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Disaster Recovery
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        

<a
  href="https://github.com/elastisys/compliantkubernetes/"
  title=""
  style="display: block; font-size: .65rem; line-height: 1.2; white-space: nowrap; -webkit-backface-visibility: hidden; backface-visibility: hidden; transition: opacity 250ms;"
>
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Elastisys Compliant Kubernetes" class="md-nav__button md-logo" aria-label="Elastisys Compliant Kubernetes" data-md-component="logo">
      
  <img src="../../img/logo.png" alt="logo">

    </a>
    Elastisys Compliant Kubernetes
  </label>
  
    <div class="md-nav__source">
      

<a
  href="https://github.com/elastisys/compliantkubernetes/"
  title=""
  style="display: block; font-size: .65rem; line-height: 1.2; white-space: nowrap; -webkit-backface-visibility: hidden; backface-visibility: hidden; transition: opacity 250ms;"
>
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" tabindex="0" aria-expanded="false">
          For Application Developers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="For Application Developers" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          For Application Developers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" >
      
      
      
        <label class="md-nav__link" for="__nav_2_1" tabindex="0" aria-expanded="false">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting Started" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/prepare/" class="md-nav__link">
        Step 1: Prepare
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/deploy/" class="md-nav__link">
        Step 2: Deploy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/operate/" class="md-nav__link">
        Step 3: Operate
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2_2" tabindex="0" aria-expanded="false">
          Go Deeper
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Go Deeper" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Go Deeper
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/prepare-application/" class="md-nav__link">
        Prepare Your Application
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/registry/" class="md-nav__link">
        Container registry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/continous-development/" class="md-nav__link">
        Continous Development
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/network-model/" class="md-nav__link">
        Network Model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/kubernetes-api/" class="md-nav__link">
        Kubernetes API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/kubernetes-ui/" class="md-nav__link">
        Kubernetes UI (Lens)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/logs/" class="md-nav__link">
        Logs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/log-based-alerts/" class="md-nav__link">
        Log-based Alerts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/long-term-log-retention/" class="md-nav__link">
        Long-term Log Retention
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/metrics/" class="md-nav__link">
        Metrics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/alerts/" class="md-nav__link">
        Metric Alerts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/maintenance/" class="md-nav__link">
        Maintenance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/backup/" class="md-nav__link">
        Backups
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/ci-cd/" class="md-nav__link">
        CI/CD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/demarcation/" class="md-nav__link">
        Demarcation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/delegation/" class="md-nav__link">
        How to Delegate
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" >
      
      
      
        <label class="md-nav__link" for="__nav_2_3" tabindex="0" aria-expanded="false">
          Safeguards
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Safeguards" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Safeguards
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/safeguards/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/safeguards/enforce-no-root/" class="md-nav__link">
        Enforce No Root
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/safeguards/enforce-networkpolicies/" class="md-nav__link">
        Enforce NetworkPolicies
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/safeguards/enforce-resources/" class="md-nav__link">
        Enforce Resources
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/safeguards/enforce-trusted-registries/" class="md-nav__link">
        Enforce Trusted Registries
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/safeguards/enforce-no-latest-tag/" class="md-nav__link">
        Enforce No Latest Tag
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_2_4" type="checkbox" id="__nav_2_4" >
      
      
      
        <label class="md-nav__link" for="__nav_2_4" tabindex="0" aria-expanded="false">
          Additional Services
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Additional Services" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          Additional Services
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/additional-services/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/additional-services/postgresql/" class="md-nav__link">
        PostgreSQL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/additional-services/timescaledb/" class="md-nav__link">
        TimescaleDB
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/additional-services/redis/" class="md-nav__link">
        Redis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/additional-services/rabbitmq/" class="md-nav__link">
        RabbitMQ
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/go-live/" class="md-nav__link">
        Go-live Checklist
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/faq/" class="md-nav__link">
        FAQ
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3" tabindex="0" aria-expanded="true">
          For Kubernetes Administrators
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="For Kubernetes Administrators" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          For Kubernetes Administrators
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../provider-audit/" class="md-nav__link">
        Provider Audit
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../on-prem-standard/" class="md-nav__link">
        Standard Template for on-prem Environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../qa/" class="md-nav__link">
        QA
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3_6" type="checkbox" id="__nav_3_6" >
      
      
      
        <label class="md-nav__link" for="__nav_3_6" tabindex="0" aria-expanded="false">
          Advanced Configuration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Advanced Configuration" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_6">
          <span class="md-nav__icon md-icon"></span>
          Advanced Configuration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configure/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cluster-sizing/" class="md-nav__link">
        Sizing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ingress/" class="md-nav__link">
        Ingress
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../access-control/" class="md-nav__link">
        Access Control
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../user-alerts/" class="md-nav__link">
        User Alerts
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Disaster Recovery
      </a>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../break-glass/" class="md-nav__link">
        Breaking the Glass
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../credentials/" class="md-nav__link">
        Use of Credentials
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../capacity-management/" class="md-nav__link">
        Capacity Management
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../maintenance/" class="md-nav__link">
        Maintenance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../faq/" class="md-nav__link">
        FAQ
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" tabindex="0" aria-expanded="false">
          For CISOs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="For CISOs" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          For CISOs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ciso-guide/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      
      
        <label class="md-nav__link" for="__nav_4_2" tabindex="0" aria-expanded="false">
          Controls by Regulation/Standard
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Controls by Regulation/Standard" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Controls by Regulation/Standard
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ciso-guide/controls/iso-27001/" class="md-nav__link">
        ISO 27001
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ciso-guide/controls/hipaa/" class="md-nav__link">
        HIPAA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ciso-guide/controls/bsi-it-grundschutz/" class="md-nav__link">
        BSI IT-Grundschutz
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ciso-guide/audit-logs/" class="md-nav__link">
        Audit Logs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ciso-guide/backup/" class="md-nav__link">
        Backup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ciso-guide/cryptography/" class="md-nav__link">
        Cryptography
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ciso-guide/intrusion-detection/" class="md-nav__link">
        Intrusion Detection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ciso-guide/policy-as-code/" class="md-nav__link">
        Policy-as-Code
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ciso-guide/network-security/" class="md-nav__link">
        Network Security
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ciso-guide/capacity-management/" class="md-nav__link">
        Capacity Management
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ciso-guide/vulnerability/" class="md-nav__link">
        Vulnerability Management
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ciso-guide/log-review/" class="md-nav__link">
        Log Review
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ciso-guide/faq/" class="md-nav__link">
        FAQ
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" tabindex="0" aria-expanded="false">
          For Contributors
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="For Contributors" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          For Contributors
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../contributor-guide/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../adr/" class="md-nav__link">
        Architectural Decision Log
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tech-radar/" class="md-nav__link">
        Tech Radar
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" tabindex="0" aria-expanded="false">
          Release Notes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Release Notes" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Release Notes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/ck8s/" class="md-nav__link">
        Compliant Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/kubespray/" class="md-nav__link">
        CK8S Kubespray
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/postgres/" class="md-nav__link">
        CK8S PostgreSQL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/rabbitmq/" class="md-nav__link">
        CK8S RabbitMQ
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/redis/" class="md-nav__link">
        CK8S Redis
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../roadmap/" class="md-nav__link">
        Roadmap
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://elastisys.com/" class="md-nav__link">
        Support ⧉
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://elastisys.com/blog/" class="md-nav__link">
        Blog ⧉
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://elastisys.com/privacy-policy/" class="md-nav__link">
        Privacy Policy ⧉
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  <!--
  Copyright (c) 2016-2023 Martin Donath <martin.donath@squidfunk.com>
  Copyright (c) 2023 Cristian Klein <cristian.klein@elastisys.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Tags -->


  <nav class="md-tags" >
    
      
      
        <a href="../../ciso-guide/controls/iso-27001#iso-27001-a1231" class="md-tag">ISO 27001 A.12.3.1</a>
      
    
      
      
        <a href="../../ciso-guide/controls/iso-27001#iso-27001-a1711" class="md-tag">ISO 27001 A.17.1.1</a>
      
    
      
      
        <a href="../../ciso-guide/controls/hipaa#hipaa-s24-contingency-plan-disaster-recovery-plan-164308a7iib" class="md-tag">HIPAA S24 - Contingency Plan - Disaster Recovery Plan - § 164.308(a)(7)(ii)(B)</a>
      
    
  </nav>


<!-- Actions -->

  
  


<!--
  Check whether the content starts with a level 1 headline. If it doesn't, the
  page title (or respectively site name) is used as the main headline.
-->



<!-- Page content -->
<h1 id="disaster-recovery">Disaster Recovery<a class="headerlink" href="#disaster-recovery" title="Permanent link">&para;</a></h1>
<p>This document details disaster recovery procedures for Compliant Kubernetes. These procedures must be executed by the administrator.</p>
<h2 id="compliant-need">Compliant Need<a class="headerlink" href="#compliant-need" title="Permanent link">&para;</a></h2>
<p>Disaster recovery is mandated by several regulations and information security standards. For example, in ISO 27001:2013, the annexes that mostly concerns disaster recovery are:</p>
<ul>
<li><a href="https://www.isms.online/iso-27001/annex-a-12-operations-security/">A.12.3.1 Information Backup</a></li>
<li><a href="https://www.isms.online/iso-27001/annex-a-17-information-security-aspects-of-business-continuity-management/">A.17.1.1 Planning Information Security Continuity</a></li>
</ul>
<h2 id="object-storage-providers">Object storage providers<a class="headerlink" href="#object-storage-providers" title="Permanent link">&para;</a></h2>
<h3 id="feature-matrix">Feature matrix<a class="headerlink" href="#feature-matrix" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Provider</th>
<th>Write-only credentials</th>
</tr>
</thead>
<tbody>
<tr>
<td>AWS S3</td>
<td>Yes</td>
</tr>
<tr>
<td>Citycloud S3</td>
<td>No</td>
</tr>
<tr>
<td>Exoscale S3</td>
<td>Yes</td>
</tr>
<tr>
<td>GCP</td>
<td>Yes</td>
</tr>
<tr>
<td>Safespring S3</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<h2 id="off-site-backups">Off-site backups<a class="headerlink" href="#off-site-backups" title="Permanent link">&para;</a></h2>
<p>Backups can be set up to be replicated off-site using CronJobs.</p>
<p>In version v0.23 these can be <strong>encrypted</strong> before they are sent off-site, which means they must first be restored to be usable. <br/>
It is possible to restore serviecs directly from <strong>unencrypted</strong> off-site backups with some additional steps.</p>
<p>See <a href="https://github.com/elastisys/compliantkubernetes-apps/tree/main/scripts/restore-sync">the instructions in <code>compliantkubernetes-apps</code></a> for how to restore off-site backups.</p>
<h2 id="when-a-new-regioncloud-provider-is-used">When a new region/cloud provider is used<a class="headerlink" href="#when-a-new-regioncloud-provider-is-used" title="Permanent link">&para;</a></h2>
<ul>
<li>Configure and set base ck8s-configs:</li>
</ul>
<p>sc-config.yaml:</p>
<p><code>harbor.persistence.swift.*</code>,<code>objectStorage.sync.*</code></p>
<p>common-config.yaml:</p>
<p><code>objectStorage.s3.region</code>, <code>objectStorage.s3.regionEndpoint</code></p>
<p>secrets.yaml:</p>
<p><code>dex.connectors.*</code>, <code>harbor.persistence.swift.username</code>, <code>harbor.persistence.swift.password</code>, <code>objectStorage.s3.accessKey</code>, <code>objectStorage.s3.secretKey</code></p>
<p>.state/s3cfg.ini:</p>
<p><code>access_key</code>, <code>secret_key</code>, <code>host_base</code>, <code>host_bucket</code></p>
<ul>
<li>Configure and set custom ck8s-configs:</li>
</ul>
<p>Examples can be files containing Identity Provider, Cloud Provider, or DNS critical information.</p>
<h2 id="opensearch">OpenSearch<a class="headerlink" href="#opensearch" title="Permanent link">&para;</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For Open Distro for Elasticsearch used in v0.18 and earlier, the same approach for backup and restore can be used with different naming, using <code>elasticsearch</code> for the CronJob and <code>elastic</code> for the namespace instead of <code>opensearch</code>.</p>
</div>
<h3 id="backup">Backup<a class="headerlink" href="#backup" title="Permanent link">&para;</a></h3>
<p>OpenSearch is set up to store backups in an S3 bucket. There is a CronJob called <code>opensearch-backup</code> in the cluster that is invoking the snapshot process in OpenSearch.</p>
<p>To take a snapshot on-demand, execute</p>
<div class="highlight"><pre><span></span><code>./bin/ck8s ops kubectl sc -n opensearch-system create job --from=cronjob/opensearch-backup &lt;name-of-job&gt;
</code></pre></div>
<h3 id="restore">Restore<a class="headerlink" href="#restore" title="Permanent link">&para;</a></h3>
<p>Set the following variables</p>
<ul>
<li><code>user</code> - OpenSearch user with permissions to manage snapshots, usually <code>admin</code></li>
<li><code>password</code> - password for the above user</li>
<li><code>os_url</code> - URL to OpenSearch</li>
</ul>
<div class="admonition important">
<p class="admonition-title">Restoring from off-site backup</p>
<ul>
<li>
<p>To restore from an <strong>encrypted</strong> off-site backup:</p>
<p>First import the backup into the main S3 service and register the restored bucket as a new snapshot repository:
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-kL<span class="w"> </span>-u<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">user</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">password</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>-X<span class="w"> </span>PUT<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">os_url</span><span class="si">}</span><span class="s2">/_snapshot/backup-repository?pretty&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span>-d<span class="s1">&#39;</span>
<span class="s1">{</span>
<span class="s1">  &quot;type&quot;: &quot;s3&quot;,</span>
<span class="s1">  &quot;settings&quot;: {</span>
<span class="s1">    &quot;bucket&quot;: &quot;&lt;restored-bucket&gt;&quot;,</span>
<span class="s1">    &quot;readonly&quot;: true</span>
<span class="s1">  }</span>
<span class="s1">}</span>
<span class="s1">&#39;</span>
</code></pre></div>
Then restore from this snapshot repository (<code>backup-repositroy</code>) in OpenSearch.</p>
</li>
<li>
<p>To restore from an <strong>unencrypted</strong> off-site backup:</p>
<p>Configure the remote and bucket as the main S3 service and bucket for apps and OpenSearch respectively, then update the OpenSearch Helm releases and perform the restore.
It is recommended to either suspend or remove the OpenSearch backup CronJob to prevent it from running while restoring.</p>
<p>Remember to revert to the regular S3 service afterwards and reactivate the backup CronJob! <br/>
Replace the previous snapshot repository if it is unusable.</p>
</li>
</ul>
</div>
<p>List snapshot repositories</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Simple</span>
❯<span class="w"> </span>curl<span class="w"> </span>-kL<span class="w"> </span>-u<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">user</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">password</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">os_url</span><span class="si">}</span><span class="s2">/_cat/repositories?v&quot;</span>
id<span class="w">                   </span><span class="nb">type</span>
opensearch-snapshots<span class="w">   </span>s3

<span class="c1"># Detailed</span>
❯<span class="w"> </span>curl<span class="w"> </span>-kL<span class="w"> </span>-u<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">user</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">password</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">os_url</span><span class="si">}</span><span class="s2">/_snapshot/?pretty&quot;</span>
<span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;opensearch-snapshots&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;type&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;s3&quot;</span>,
<span class="w">    </span><span class="s2">&quot;settings&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;bucket&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;opensearch-backup&quot;</span>,
<span class="w">      </span><span class="s2">&quot;client&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;default&quot;</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">  </span><span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>List available snapshots</p>
<div class="highlight"><pre><span></span><code><span class="nv">snapshot_repo</span><span class="o">=</span>&lt;name/id<span class="w"> </span>from<span class="w"> </span>previous<span class="w"> </span>step&gt;

<span class="c1"># Simple</span>
❯<span class="w"> </span>curl<span class="w"> </span>-kL<span class="w"> </span>-u<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">user</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">password</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">os_url</span><span class="si">}</span><span class="s2">/_cat/snapshots/</span><span class="si">${</span><span class="nv">snapshot_repo</span><span class="si">}</span><span class="s2">?v&amp;s=id&quot;</span>
id<span class="w">                         </span>status<span class="w"> </span>start_epoch<span class="w"> </span>start_time<span class="w"> </span>end_epoch<span class="w">  </span>end_time<span class="w"> </span>duration<span class="w"> </span>indices<span class="w"> </span>successful_shards<span class="w"> </span>failed_shards<span class="w"> </span>total_shards
snapshot-20211231_120002z<span class="w"> </span>SUCCESS<span class="w"> </span><span class="m">1640952003</span><span class="w">  </span><span class="m">12</span>:00:03<span class="w">   </span><span class="m">1640952082</span><span class="w"> </span><span class="m">12</span>:01:22<span class="w">     </span><span class="m">1</span>.3m<span class="w">      </span><span class="m">54</span><span class="w">                </span><span class="m">54</span><span class="w">             </span><span class="m">0</span><span class="w">           </span><span class="m">54</span>
snapshot-20220101_000003z<span class="w"> </span>SUCCESS<span class="w"> </span><span class="m">1640995203</span><span class="w">  </span><span class="m">00</span>:00:03<span class="w">   </span><span class="m">1640995367</span><span class="w"> </span><span class="m">00</span>:02:47<span class="w">     </span><span class="m">2</span>.7m<span class="w">      </span><span class="m">59</span><span class="w">                </span><span class="m">59</span><span class="w">             </span><span class="m">0</span><span class="w">           </span><span class="m">59</span>
snapshot-20220101_120002z<span class="w"> </span>SUCCESS<span class="w"> </span><span class="m">1641038403</span><span class="w">  </span><span class="m">12</span>:00:03<span class="w">   </span><span class="m">1641038533</span><span class="w"> </span><span class="m">12</span>:02:13<span class="w">     </span><span class="m">2</span>.1m<span class="w">      </span><span class="m">57</span><span class="w">                </span><span class="m">57</span><span class="w">             </span><span class="m">0</span><span class="w">           </span><span class="m">57</span>
...

<span class="c1"># Detailed list of all snapshots</span>
curl<span class="w"> </span>-kL<span class="w"> </span>-u<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">user</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">password</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">os_url</span><span class="si">}</span><span class="s2">/_snapshot/</span><span class="si">${</span><span class="nv">snapshot_repo</span><span class="si">}</span><span class="s2">/_all?pretty&quot;</span>

<span class="c1"># Detailed list of specific snapshot</span>
❯<span class="w"> </span>curl<span class="w"> </span>-kL<span class="w"> </span>-u<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">user</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">password</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">os_url</span><span class="si">}</span><span class="s2">/_snapshot/</span><span class="si">${</span><span class="nv">snapshot_repo</span><span class="si">}</span><span class="s2">/snapshot-20220104_120002z?pretty&quot;</span>
<span class="o">{{</span>
<span class="w">  </span><span class="s2">&quot;snapshots&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="o">[</span>
<span class="w">    </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;snapshot&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;snapshot-20220104_120002z&quot;</span>,
<span class="w">      </span><span class="s2">&quot;uuid&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;oClQdNAyTeiEmZb5dVh0SQ&quot;</span>,
<span class="w">      </span><span class="s2">&quot;version_id&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="m">135238127</span>,
<span class="w">      </span><span class="s2">&quot;version&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;1.2.3&quot;</span>,
<span class="w">      </span><span class="s2">&quot;indices&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="o">[</span>
<span class="w">        </span><span class="s2">&quot;authlog-default-2021.12.20-000001&quot;</span>,
<span class="w">        </span><span class="s2">&quot;authlog-default-2021.12.30-000011&quot;</span>,
<span class="w">        </span><span class="s2">&quot;authlog-default-2022.01.03-000015&quot;</span>,
<span class="w">        </span><span class="s2">&quot;other-default-2021.12.30-000011&quot;</span>,
<span class="w">        </span>...
<span class="w">      </span><span class="o">]</span>,
<span class="w">      </span><span class="s2">&quot;data_streams&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="o">]</span>,
<span class="w">      </span><span class="s2">&quot;include_global_state&quot;</span><span class="w"> </span>:<span class="w"> </span>false,
<span class="w">      </span><span class="s2">&quot;state&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;SUCCESS&quot;</span>,
<span class="w">      </span><span class="s2">&quot;start_time&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;2022-01-04T12:00:02.596Z&quot;</span>,
<span class="w">      </span><span class="s2">&quot;start_time_in_millis&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="m">1641297602596</span>,
<span class="w">      </span><span class="s2">&quot;end_time&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;2022-01-04T12:01:07.833Z&quot;</span>,
<span class="w">      </span><span class="s2">&quot;end_time_in_millis&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="m">1641297667833</span>,
<span class="w">      </span><span class="s2">&quot;duration_in_millis&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="m">65237</span>,
<span class="w">      </span><span class="s2">&quot;failures&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="o">]</span>,
<span class="w">      </span><span class="s2">&quot;shards&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="s2">&quot;total&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="m">66</span>,
<span class="w">        </span><span class="s2">&quot;failed&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="m">0</span>,
<span class="w">        </span><span class="s2">&quot;successful&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="m">66</span>
<span class="w">      </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">  </span><span class="o">]</span>
<span class="o">}</span>
</code></pre></div>
<p>You usually select the latest snapshot containing the indices you want to restore.
Restore one or multiple indices from a snapshot</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You cannot restore a write index (the latest index) if you already have a write index connected to the same index alias (which will happen if you have started to receive logs).</p>
</div>
<div class="highlight"><pre><span></span><code><span class="nv">snapshot_name</span><span class="o">=</span>&lt;Snapshot<span class="w"> </span>name<span class="w"> </span>from<span class="w"> </span>previous<span class="w"> </span>step&gt;
<span class="nv">indices</span><span class="o">=</span><span class="s2">&quot;&lt;list of comma separated indices/index patterns&gt;&quot;</span>

curl<span class="w"> </span>-kL<span class="w"> </span>-u<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">user</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">password</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">os_url</span><span class="si">}</span><span class="s2">/_snapshot/</span><span class="si">${</span><span class="nv">snapshot_repo</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">snapshot_name</span><span class="si">}</span><span class="s2">/_restore?pretty&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span>-d<span class="s1">&#39;</span>
<span class="s1">{</span>
<span class="s1">  &quot;indices&quot;: &quot;&#39;</span><span class="si">${</span><span class="nv">indices</span><span class="si">}</span><span class="s1">&#39;&quot;</span>
<span class="s1">}</span>
<span class="s1">&#39;</span>
</code></pre></div>
<p>Read the <a href="https://opensearch.org/docs/latest/opensearch/snapshot-restore/">documentation</a> to see the API, all parameters and their explanations.</p>
<h4 id="restoring-opensearch-dashboards-data">Restoring OpenSearch Dashboards data<a class="headerlink" href="#restoring-opensearch-dashboards-data" title="Permanent link">&para;</a></h4>
<p>Data in OpenSearch Dashboards (saved searches, visualizations, dashboards, etc) is stored in the index <code>.opensearch_dashboards_x</code>. To restore that data you first need to delete the index and then do a restore.</p>
<p>This will overwrite anything in the current <code>.opensearch_dashboards_x</code> index. If there is something new that should be saved, then <a href="https://www.elastic.co/guide/en/kibana/7.10/managing-saved-objects.html#_export">export</a> the saved objects and <a href="https://www.elastic.co/guide/en/kibana/7.10/managing-saved-objects.html#_import">import</a> them after the restore.</p>
<p>There can be multiple <code>.opensearch_dashboards</code> indices in Opensearch, the current index should be the one you want to restore. To view your dashboard indices, follow these steps.</p>
<div class="highlight"><pre><span></span><code><span class="nv">snapshot_name</span><span class="o">=</span>&lt;Snapshot<span class="w"> </span>name<span class="w"> </span>from<span class="w"> </span>previous<span class="w"> </span>step&gt;

curl<span class="w"> </span>-kL<span class="w"> </span>-u<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">user</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">password</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="si">${</span><span class="nv">os_url</span><span class="si">}</span><span class="s1">&#39;/.opensearch_dashboard*?pretty&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;keys&#39;</span>
</code></pre></div>
<p>If multiple <code>.opensearch_dashboards_x</code> indices show up, run this to see the index that the alias is currently looking at.</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-kL<span class="w"> </span>-u<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">user</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">password</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="si">${</span><span class="nv">os_url</span><span class="si">}</span><span class="s1">&#39;/_alias/.opensearch_dashboard*?pretty&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;keys&#39;</span>
</code></pre></div>
<p>Make sure that the index you want to restore also exists on the snapshot. (May be an issue if you are using an old snapshot)</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-kL<span class="w"> </span>-u<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">user</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">password</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">os_url</span><span class="si">}</span><span class="s2">/_snapshot/</span><span class="si">${</span><span class="nv">snapshot_repo</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">snapshot_name</span><span class="si">}</span><span class="s2">?pretty&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.snapshots[].indices&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>.opensearch_dashboards
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you visit the <code>"&lt;os_url&gt;/app/dashboards"</code> page in the Opensearch GUI after deleting the index and before restoring the index, another empty index <code>.opensearch_dashboards</code> will be created. You need to delete this manually, which can be done with
<div class="highlight"><pre><span></span><code><span class="sb">`</span>curl<span class="w"> </span>-kL<span class="w"> </span>-u<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">user</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">password</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>-X<span class="w"> </span>DELETE<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">os_url</span><span class="si">}</span><span class="s2">/.opensearch_dashboards?pretty&quot;</span><span class="sb">`</span>
</code></pre></div></p>
</div>
<div class="highlight"><pre><span></span><code><span class="nv">index_to_restore</span><span class="o">=</span>&lt;Index<span class="w"> </span>name<span class="w"> </span>from<span class="w"> </span>previous<span class="w"> </span>step&gt;

curl<span class="w"> </span>-kL<span class="w"> </span>-u<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">user</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">password</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>-X<span class="w"> </span>DELETE<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">os_url</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">index_to_restore</span><span class="si">}</span><span class="s2">?pretty&quot;</span>

curl<span class="w"> </span>-kL<span class="w"> </span>-u<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">user</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">password</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">os_url</span><span class="si">}</span><span class="s2">/_snapshot/</span><span class="si">${</span><span class="nv">snapshot_repo</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">snapshot_name</span><span class="si">}</span><span class="s2">/_restore?pretty&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span>-d<span class="s1">&#39;</span>
<span class="s1">{</span>
<span class="s1">  &quot;indices&quot;: &quot;&#39;</span><span class="si">${</span><span class="nv">index_to_restore</span><span class="si">}</span><span class="s1">&#39;&quot;</span>
<span class="s1">}</span>
<span class="s1">&#39;</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For Open Distro for Elasticsearch and Kibana used in v0.18 and earlier, the same approach can be used with different naming, using <code>.kibana_1</code> for the index name instead of <code>.opensearch_dashboards_1</code>.</p>
</div>
<h3 id="start-new-cluster-from-snapshot">Start new cluster from snapshot<a class="headerlink" href="#start-new-cluster-from-snapshot" title="Permanent link">&para;</a></h3>
<p>This process is very similar to the one described above, but there are a few extra steps to carry out.</p>
<p>Before you install OpenSearch you can preferably disable the initial index creation to make the restore process leaner by setting the following configuration option:</p>
<div class="highlight"><pre><span></span><code>opensearch.createIndices:<span class="w"> </span><span class="nb">false</span>
</code></pre></div>
<p>Install the OpenSearch suite:</p>
<div class="highlight"><pre><span></span><code>./bin/ck8s<span class="w"> </span>ops<span class="w"> </span>helmfile<span class="w"> </span>sc<span class="w"> </span>-l<span class="w"> </span><span class="nv">group</span><span class="o">=</span>opensearch<span class="w"> </span>apply
</code></pre></div>
<p>Wait for the the installation to complete.</p>
<p>After the installation, go back up to the <strong>Restore</strong> section to proceed with the restore.
If you want to restore all indices, use the following <code>indices</code> variable</p>
<div class="highlight"><pre><span></span><code><span class="nv">indices</span><span class="o">=</span><span class="s2">&quot;kubernetes-*,kubeaudit-*,other-*&quot;</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This process assumes that you are using the same S3 bucket as your previous cluster. If you aren't:</p>
<ul>
<li>Register a new S3 snapshot repository to the old bucket as <a href="https://opensearch.org/docs/latest/opensearch/snapshot-restore/#register-repository">described here</a></li>
<li>Use the newly registered snapshot repository in the restore process</li>
</ul>
</div>
<h2 id="harbor">Harbor<a class="headerlink" href="#harbor" title="Permanent link">&para;</a></h2>
<h3 id="backup_1">Backup<a class="headerlink" href="#backup_1" title="Permanent link">&para;</a></h3>
<p>Harbor is set up to store backups of the database in an S3 bucket (note that this does not include the actual images, since those are already stored in S3 by default).
There is a CronJob called <code>harbor-backup-cronjob</code> in the cluster that is taking a database dump and uploading it to a S3 bucket.</p>
<p>To take a backup on-demand, execute</p>
<div class="highlight"><pre><span></span><code>./bin/ck8s<span class="w"> </span>ops<span class="w"> </span>kubectl<span class="w"> </span>sc<span class="w"> </span>-n<span class="w"> </span>harbor<span class="w"> </span>create<span class="w"> </span>job<span class="w"> </span>--from<span class="o">=</span>cronjob/harbor-backup-cronjob<span class="w"> </span>&lt;name-of-job&gt;
</code></pre></div>
<h3 id="restore_1">Restore<a class="headerlink" href="#restore_1" title="Permanent link">&para;</a></h3>
<div class="admonition important">
<p class="admonition-title">Restoring from off-site backup</p>
<p>Since Harbor stores both database backups and images in the same bucket it is recommended to restore the off-site backup into the main S3 service first, reconfigure Harbor to use it, then restore the database from it.</p>
</div>
<p>Instructions for how to restore Harbor can be found in <code>compliantkubernetes-apps</code>: <a href="https://github.com/elastisys/compliantkubernetes-apps/tree/main/scripts/restore#restore-harbor">https://github.com/elastisys/compliantkubernetes-apps/tree/main/scripts/restore#restore-harbor</a></p>
<h2 id="velero">Velero<a class="headerlink" href="#velero" title="Permanent link">&para;</a></h2>
<p>These instructions make use of the Velero CLI, you can download it here: <a href="https://github.com/vmware-tanzu/velero/releases/tag/v1.7.1">https://github.com/vmware-tanzu/velero/releases/tag/v1.7.1</a> (version 1.7.1).
The CLI needs the env variable <code>KUBECONFIG</code> set to the path of a decrypted kubeconfig.
Read more about Velero here: <a href="https://compliantkubernetes.io/user-guide/backup/">https://compliantkubernetes.io/user-guide/backup/</a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This documentation uses the Velero CLI, as opposed to Velero CRDs, since that is what is encouraged by upstream documentation.</p>
</div>
<h3 id="backup_2">Backup<a class="headerlink" href="#backup_2" title="Permanent link">&para;</a></h3>
<p>Velero is set up to take daily backups and store them in an S3 bucket.
The daily backup will not take backups of everything in a kubernetes cluster, it will instead look for certain labels and annotations.
Read more about those labels and annotations here: <a href="https://compliantkubernetes.io/user-guide/backup/#backing-up">https://compliantkubernetes.io/user-guide/backup/#backing-up</a></p>
<p>It is also possible to take on-demand backups.
Then you can freely chose what to backup and do not have to base it on the same labels.
A basic example with the Velero CLI would be <code>velero backup create manual-backup</code>, which would take a backup of all kubernetes resources (though not the data in the volumes by default).
Check which arguments you can use by running <code>velero backup create --help</code>.</p>
<h3 id="restore_2">Restore<a class="headerlink" href="#restore_2" title="Permanent link">&para;</a></h3>
<p>Restoring from a backup with Velero is meant to be a type of disaster recovery.
<strong>Velero will not overwrite existing Resources when restoring.</strong>
As such, if you want to restore the state of a Resource that is still running, the Resource must be deleted first.</p>
<p>To restore the state from the latest daily backup, run:</p>
<div class="highlight"><pre><span></span><code>velero<span class="w"> </span>restore<span class="w"> </span>create<span class="w"> </span>--from-schedule<span class="w"> </span>velero-daily-backup<span class="w"> </span>--wait
</code></pre></div>
<p>This command will wait until the restore has finished.
You can also do partial restorations, e.g. just restoring one namespace, by using different arguments.
You can also restore from manual backups by using the flag <code>--from-backup &lt;backup-name&gt;</code></p>
<p>Persistent Volumes are only restored if a Pod with the backup annotation is restored.
Multiple Pods can have an annotation for the same Persistent Volume.
When restoring the Persistent Volume it will overwrite any existing files with the same names as the files to be restored.
Any other files will be left as they were before the restoration started.
So a restore will not wipe the volume clean and then restore.
If a clean wipe is the desired behavior, then the volume must be wiped manually before restoring.</p>
<h3 id="restore-from-off-site-backup">Restore from off-site backup<a class="headerlink" href="#restore-from-off-site-backup" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Restoring from <strong>encrypted</strong> off-site backup:</p>
<p>Recover the encrypted bucket into the main S3 service and reconfigure Velero to use this bucket, then follow the regular instructions.</p>
<p>The references in Kubernetes might need to be deleted so Velero can resync from the bucket:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Note that this is only backup metadata</span>
kubectl<span class="w"> </span>-n<span class="w"> </span>velero<span class="w"> </span>delete<span class="w"> </span>backups.velero.io<span class="w"> </span>--all
</code></pre></div>
</li>
<li>
<p>Restoring from <strong>unencrypted</strong> off-site backup:</p>
<p>To recover directly from off-site backup the backup-location must be reconfigured:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">S3_BUCKET</span><span class="o">=</span><span class="s2">&quot;&lt;off-site-s3-bucket&gt;&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">S3_PREFIX</span><span class="o">=</span><span class="s2">&quot;&lt;service-cluster|workload-cluster&gt;&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">S3_ACCESS_KEY</span><span class="o">=</span><span class="k">$(</span>sops<span class="w"> </span>-d<span class="w"> </span>--extract<span class="w"> </span><span class="s1">&#39;[&quot;objectStorage&quot;][&quot;sync&quot;][&quot;s3&quot;][&quot;accessKey&quot;]&#39;</span><span class="k">)</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CK8S_CONFIG_PATH</span><span class="s2">/secrets.yaml&quot;</span><span class="o">)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">S3_SECRET_KEY</span><span class="o">=</span><span class="k">$(</span>sops<span class="w"> </span>-d<span class="w"> </span>--extract<span class="w"> </span><span class="s1">&#39;[&quot;objectStorage&quot;][&quot;sync&quot;][&quot;s3&quot;][&quot;accessKey&quot;]&#39;</span><span class="k">)</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CK8S_CONFIG_PATH</span><span class="s2">/secrets.yaml&quot;</span><span class="o">)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">S3_REGION</span><span class="o">=</span><span class="k">$(</span>yq<span class="w"> </span>r<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CK8S_CONFIG_PATH</span><span class="s2">/sc-config.yaml&quot;</span><span class="w"> </span><span class="s2">&quot;objectStorage.sync.s3.region&quot;</span><span class="k">)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">S3_ENDPOINT</span><span class="o">=</span><span class="k">$(</span>yq<span class="w"> </span>r<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CK8S_CONFIG_PATH</span><span class="s2">/sc-config.yaml&quot;</span><span class="w"> </span><span class="s2">&quot;objectStorage.sync.s3.regionEndpoint&quot;</span><span class="k">)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">S3_PATH_STYLE</span><span class="o">=</span><span class="k">$(</span>yq<span class="w"> </span>r<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CK8S_CONFIG_PATH</span><span class="s2">/sc-config.yaml&quot;</span><span class="w"> </span><span class="s2">&quot;objectStorage.sync.s3.forcePathStyle&quot;</span><span class="k">)</span>

<span class="c1"># Delete default backup location</span>
velero<span class="w"> </span>backup-location<span class="w"> </span>delete<span class="w"> </span>default

<span class="c1"># Delete backups from default backup location, note that this is only the backup metadata</span>
kubectl<span class="w"> </span>-n<span class="w"> </span>velero<span class="w"> </span>delete<span class="w"> </span>backups.velero.io<span class="w"> </span>--all

<span class="c1"># Create off-site credentials</span>
kubectl<span class="w"> </span>-n<span class="w"> </span>velero<span class="w"> </span>create<span class="w"> </span>secret<span class="w"> </span>generic<span class="w"> </span>velero-backup<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--from-literal<span class="o">=</span><span class="nv">cloud</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[default]\naws_access_key_id: </span><span class="si">${</span><span class="nv">S3_ACCESS_KEY</span><span class="si">}</span><span class="s2">\naws_secret_access_key: </span><span class="si">${</span><span class="nv">S3_SECRET_KEY</span><span class="si">}</span><span class="s2">\n&quot;</span><span class="k">)</span><span class="s2">&quot;</span>

<span class="c1"># Create off-site backup location</span>
velero<span class="w"> </span>backup-location<span class="w"> </span>create<span class="w"> </span>backup<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--access-mode<span class="w"> </span>ReadOnly<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--provider<span class="w"> </span>aws<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--bucket<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">S3_BUCKET</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--prefix<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">S3_PREFIX</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--config<span class="o">=</span><span class="s2">&quot;region=</span><span class="si">${</span><span class="nv">S3_REGION</span><span class="si">}</span><span class="s2">,s3Url=</span><span class="si">${</span><span class="nv">S3_ENDPOINT</span><span class="si">}</span><span class="s2">,s3ForcePathStyle=</span><span class="si">${</span><span class="nv">S3_PATH_STYLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--credential<span class="o">=</span>velero-backup<span class="o">=</span>cloud
</code></pre></div>
<p>Check that the backup-location becomes available:
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>velero<span class="w"> </span>backup-location<span class="w"> </span>get
<span class="go">NAME     PROVIDER   BUCKET/PREFIX       PHASE       LAST VALIDATED   ACCESS MODE   DEFAULT</span>
<span class="go">backup   aws        &lt;bucket&gt;/&lt;prefix&gt;   Available   &lt;timestamp&gt;      ReadOnly</span>
</code></pre></div></p>
<p>Then check that the backups becomes available using <code>velero backup get</code>.
When they are available restore one of them using <code>velero restore create &lt;name-of-restore&gt; --from-backup &lt;name-of-backup&gt;</code>.</p>
<p>After the restore is complete Velero should be reconfigured to use the main S3 service again, with a new bucket if the previous one is unusable.
Updating or syncing the Helm chart will reset the backup location.</p>
<p>The secret and the backup metadata from the off-site backups can be deleted:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>-n<span class="w"> </span>velero<span class="w"> </span>delete<span class="w"> </span>secret<span class="w"> </span>velero-backup
kubectl<span class="w"> </span>-n<span class="w"> </span>velero<span class="w"> </span>delete<span class="w"> </span>backups.velero.io<span class="w"> </span>--all
</code></pre></div></p>
</li>
</ul>
<h2 id="grafana">Grafana<a class="headerlink" href="#grafana" title="Permanent link">&para;</a></h2>
<p>This refers to the user Grafana, not the ops Grafana.</p>
<h3 id="backup_3">Backup<a class="headerlink" href="#backup_3" title="Permanent link">&para;</a></h3>
<p>Grafana is set up to be included in the daily Velero backup.
We then include the Grafana deployment, pod, and PVC (including the data).
Manual backups can be taken using velero (include the same resources).</p>
<h3 id="restore_3">Restore<a class="headerlink" href="#restore_3" title="Permanent link">&para;</a></h3>
<p>To restore the Grafana backup you must:</p>
<ul>
<li>Have Grafana installed</li>
<li>
<p>Delete the grafana deployment, PVC and PV</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>delete<span class="w"> </span>deploy<span class="w"> </span>-n<span class="w"> </span>monitoring<span class="w"> </span>user-grafana
kubectl<span class="w"> </span>delete<span class="w"> </span>pvc<span class="w"> </span>-n<span class="w"> </span>monitoring<span class="w"> </span>user-grafana
</code></pre></div>
</li>
<li>
<p>Restore the velero backup</p>
<div class="highlight"><pre><span></span><code>velero<span class="w"> </span>restore<span class="w"> </span>create<span class="w"> </span>--from-schedule<span class="w"> </span>velero-daily-backup<span class="w"> </span>--wait
</code></pre></div>
</li>
</ul>

<!-- Source file information -->


<!-- Was this page helpful? -->



                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © 2022 Elastisys AB <br/> Kubernetes® is a registered trademark of The Linux Foundation in the United States and other countries, and is used pursuant to a license from The Linux Foundation. <br/> Postgres and PostgreSQL and the Elephant Logo (Slonik) are all registered trademarks of the PostgreSQL Community Association of Canada. <br/> Redis is a trademark of Redis Ltd. Any rights therein are reserved to Redis Ltd. Any use by the Compliant Kubernetes project is for referential purposes only and does not indicate any sponsorship, endorsement or affiliation between Redis and Compliant Kubernetes project. <br/> RabbitMQ is a trademark of VMware, Inc. in the U.S. and other countries. <br/> TimescaleDB and the EON mascot are trademarks of <a href="https://www.timescale.com/">Timescale, Inc.</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["toc.integrate", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.ba449ae6.min.js"></script>
      
    
  </body>
</html>