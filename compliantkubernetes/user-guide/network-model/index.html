
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Explanation of the network model in Elastisys Compliant Kubernetes, the security-focused Kubernetes distribution." name="description"/>
<meta content="Elastisys AB" name="author"/>
<link href="https://elastisys.io/compliantkubernetes/user-guide/network-model/" rel="canonical"/>
<link href="../continous-development/" rel="prev"/>
<link href="../kubernetes-api/" rel="next"/>
<link href="https://elastisys.io/compliantkubernetes/img/favicon.ico" rel="icon"/>
<meta content="mkdocs-1.5.3, mkdocs-material-9.1.21" name="generator"/>
<title>Network Model - Elastisys Compliant Kubernetes</title>
<link href="../../assets/stylesheets/main.eebd395e.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.ecc896b0.min.css" rel="stylesheet"/>
<link href="../../stylesheets/branding.css" rel="stylesheet"/>
<link href="../../stylesheets/extra.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<!-- Matomo -->
<script>
  var _paq = window._paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://matomo.elastisys.com/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '2']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Matomo Code -->
<meta content="website" property="og:type"/>
<meta content="Network Model - Elastisys Compliant Kubernetes" property="og:title"/>
<meta content="Explanation of the network model in Elastisys Compliant Kubernetes, the security-focused Kubernetes distribution." property="og:description"/>
<meta content="https://elastisys.io/compliantkubernetes/assets/images/social/user-guide/network-model.png" property="og:image"/>
<meta content="image/png" property="og:image:type"/>
<meta content="1200" property="og:image:width"/>
<meta content="630" property="og:image:height"/>
<meta content="https://elastisys.io/compliantkubernetes/user-guide/network-model/" property="og:url"/>
<meta content="summary_large_image" name="twitter:card"/>
<meta content="Network Model - Elastisys Compliant Kubernetes" name="twitter:title"/>
<meta content="Explanation of the network model in Elastisys Compliant Kubernetes, the security-focused Kubernetes distribution." name="twitter:description"/>
<meta content="https://elastisys.io/compliantkubernetes/assets/images/social/user-guide/network-model.png" name="twitter:image"/>
<meta content="
  default-src 'self';
  style-src 'self' 'unsafe-inline';
  img-src 'self' data:;
  connect-src 'self' https://matomo.elastisys.com/;
  script-src 'self' 'unsafe-inline' https://matomo.elastisys.com/;
" http-equiv="Content-Security-Policy"/>
<!-- Disable localStorage, sessionStorage and cookies -->
<script>
if (window.localStorage) {
  window.localStorage.setItem = function() { };
  window.localStorage.clear();
}
if (window.sessionStorage) {
  window.sessionStorage.setItem = function() { }
  window.sessionStorage.clear();
}
if(!document.__defineGetter__) {
  Object.defineProperty(document, 'cookie', {
    get: function(){return ''},
    set: function(){return true},
  });
} else {
  document.__defineGetter__("cookie", function() { return '';} );
  document.__defineSetter__("cookie", function() {} );
}
</script>
<!-- See https://realfavicongenerator.net -->
<link href="https://elastisys.io/compliantkubernetes/img/apple-touch-icon.png?v=1" rel="apple-touch-icon" sizes="180x180"/>
<link href="https://elastisys.io/compliantkubernetes/img/favicon-32x32.png?v=1" rel="icon" sizes="32x32" type="image/png"/>
<link href="https://elastisys.io/compliantkubernetes/img/favicon-16x16.png?v=1" rel="icon" sizes="16x16" type="image/png"/>
<link href="https://elastisys.io/compliantkubernetes/img/site.webmanifest?v=1" rel="manifest"/>
<link color="#5bbad5" href="https://elastisys.io/compliantkubernetes/img/safari-pinned-tab.svg?v=1" rel="mask-icon"/>
<link href="https://elastisys.io/compliantkubernetes/img/favicon.ico?v=1" rel="shortcut icon"/>
<meta content="#2b5797" name="msapplication-TileColor"/>
<meta content="https://elastisys.io/compliantkubernetes/img/browserconfig.xml?v=1" name="msapplication-config"/>
<meta content="#ffffff" name="theme-color"/>
<link href="../../assets/stylesheets/extra-style.6l9qvqob.min.css" rel="stylesheet"/></head>
<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="elastisys" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#network-model">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<div data-md-color-scheme="default" data-md-component="outdated" hidden="">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Elastisys Compliant Kubernetes" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Elastisys Compliant Kubernetes">
<img alt="logo" src="../../img/logo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Elastisys Compliant Kubernetes
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Network Model
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<ul class="header-links">
<li>
<a href="https://github.com/elastisys/compliantkubernetes/">
<img alt="Git logo" src="../../img/git-alt.svg" width="25px">
</img></a>
</li>
<li><a class="menu-callout" href="https://elastisys.com/">Try out Managed<br/>Compliant Kubernetes</a></li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Elastisys Compliant Kubernetes" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Elastisys Compliant Kubernetes">
<img alt="logo" src="../../img/logo.png"/>
</a>
    Elastisys Compliant Kubernetes
  </label>
<div class="md-nav__source">
<ul class="header-links">
<li>
<a href="https://github.com/elastisys/compliantkubernetes/">
<img alt="Git logo" src="../../img/git-alt.svg" width="25px">
</img></a>
</li>
<li><a class="menu-callout" href="https://elastisys.com/">Try out Managed<br/>Compliant Kubernetes</a></li>
</ul>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
        Overview
      </a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          For Application Developers
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          For Application Developers
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_1">
<span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../prepare/">
        Step 1: Prepare
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../deploy/">
        Step 2: Deploy
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../operate/">
        Step 3: Operate
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
          Go Deeper
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_2_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_2">
<span class="md-nav__icon md-icon"></span>
          Go Deeper
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../prepare-application/">
        Prepare Your Application
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../prepare-idp/">
        Prepare Your Identity Provider (IdP)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../registry/">
        Container registry
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../continous-development/">
        Continous Development
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          Network Model
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        Network Model
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#private-network">
    Private Network
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#private-dns">
    Private DNS
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ingress">
    Ingress
  </a>
<nav aria-label="Ingress" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#running-example">
    Running Example
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#letsencrypt">
    LetsEncrypt
  </a>
<nav aria-label="LetsEncrypt" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#issuing-a-certificate">
    Issuing a Certificate
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#lets-encrypt-environments">
    Let's Encrypt Environments
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rate-limits">
    Rate Limits
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#demarcation-of-responsibilities">
    Demarcation of Responsibilities
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#further-reading">
    Further Reading
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../kubernetes-api/">
        Kubernetes API
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../kubernetes-ui/">
        Kubernetes UI (Lens)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../namespaces/">
        Namespaces
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../logs/">
        Logs
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../log-based-alerts/">
        Log-based Alerts
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../long-term-log-retention/">
        Long-term Log Retention
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../metrics/">
        Metrics
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../alerts/">
        Metric Alerts
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../maintenance/">
        Maintenance
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../backup/">
        Backups
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ci-cd/">
        CI/CD
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../demarcation/">
        Demarcation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../delegation/">
        How to Delegate
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../how-many-environments/">
        How many environments?
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
          Safeguards
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_3">
<span class="md-nav__icon md-icon"></span>
          Safeguards
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../safeguards/">
        Overview
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../safeguards/enforce-no-root/">
        Enforce No Root
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../safeguards/enforce-podsecuritypolicies/">
        Enforce Restricted Privileges
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../safeguards/enforce-networkpolicies/">
        Enforce NetworkPolicies
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../safeguards/enforce-resources/">
        Enforce Resources
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../safeguards/enforce-trusted-registries/">
        Enforce Trusted Registries
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../safeguards/enforce-no-latest-tag/">
        Enforce No Latest Tag
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../safeguards/enforce-job-ttl/">
        Enforce Job TTL
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
          Additional Services
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_4">
<span class="md-nav__icon md-icon"></span>
          Additional Services
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../additional-services/">
        Overview
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../additional-services/postgresql/">
        PostgreSQL
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../additional-services/timescaledb/">
        TimescaleDB
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../additional-services/redis/">
        Redis
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../additional-services/rabbitmq/">
        RabbitMQ
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../additional-services/jaeger/">
        Jaeger (preview)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../additional-services/argocd/">
        Argo CD (preview)
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
          Self-Managed Services
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_5">
<span class="md-nav__icon md-icon"></span>
          Self-Managed Services
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../self-managed-services/ferretdb/">
        FerretDB (self-managed)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../self-managed-services/keycloak/">
        Keycloak (self-managed)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../self-managed-services/jupyterhub/">
        JupyterHub (self-managed)
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../go-live/">
        Go-live Checklist
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../troubleshooting/">
        Troubleshooting
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../faq/">
        FAQ
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          For Platform Administrators
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          For Platform Administrators
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../operator-manual/">
        Overview
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operator-manual/getting-started/">
        Getting Started
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operator-manual/provider-audit/">
        Provider Audit
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operator-manual/on-prem-standard/">
        Standard Template for on-prem Environment
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operator-manual/qa/">
        QA
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
          Advanced Configuration
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_6_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_6">
<span class="md-nav__icon md-icon"></span>
          Advanced Configuration
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../operator-manual/configure/">
        Overview
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operator-manual/cluster-sizing/">
        Sizing
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operator-manual/ingress/">
        Ingress
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operator-manual/access-control/">
        Access Control
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operator-manual/user-alerts/">
        User Alerts
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operator-manual/disaster-recovery/">
        Disaster Recovery
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operator-manual/break-glass/">
        Breaking the Glass
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operator-manual/cryptography/">
        Use of Cryptography
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operator-manual/credentials/">
        Use of Credentials
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operator-manual/capacity-management/">
        Capacity Management
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operator-manual/clock-synchronization/">
        Clock Synchronization
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operator-manual/maintenance/">
        Maintenance
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operator-manual/clean-up/">
        Clean Up
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operator-manual/troubleshooting/">
        Troubleshooting
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operator-manual/faq/">
        FAQ
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operator-manual/additional-services/">
        Additional Services
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          For CISOs and DPOs
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          For CISOs and DPOs
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../ciso-guide/">
        Overview
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ciso-guide/controls/iso-27001/">
        ISO 27001
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ciso-guide/controls/hslf-fs-201640/">
        HSLF-FS 2016:40
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ciso-guide/controls/msbfs-20207/">
        MSBFS 2020:7
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ciso-guide/controls/gdpr/">
        GDPR
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ciso-guide/controls/hipaa/">
        HIPAA
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ciso-guide/controls/bsi-it-grundschutz/">
        BSI IT-Grundschutz
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ciso-guide/controls/mdr/">
        MDR
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_9" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_9" id="__nav_4_9_label" tabindex="0">
          CISO Dashboards
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_9_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_9">
<span class="md-nav__icon md-icon"></span>
          CISO Dashboards
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../ciso-guide/audit-logs/">
        Audit Logs
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ciso-guide/backup/">
        Backup Dashboard
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ciso-guide/cryptography/">
        Cryptography Dashboard
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ciso-guide/intrusion-detection/">
        Intrusion Detection Dashboard
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ciso-guide/policy-as-code/">
        Policy-as-Code Dashboard
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ciso-guide/network-security/">
        Network Security Dashboard
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ciso-guide/capacity-management/">
        Capacity Management (Kubernetes Status) Dashboard
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ciso-guide/vulnerability/">
        Vulnerability Dashboard
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ciso-guide/log-review/">
        Log Review
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ciso-guide/faq/">
        FAQ
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ciso-guide/gdpr-art-17/">
        How do I comply with GDPR Art. 17 Right to erasure ("right to be forgotten")?
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          For Contributors
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          For Contributors
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../contributor-guide/">
        Overview
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../architecture/">
        Architecture
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../adr/">
        Architectural Decision Log
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tech-radar/">
        Tech Radar
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Release Notes
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
          Release Notes
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../release-notes/ck8s/">
        Compliant Kubernetes
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../release-notes/kubespray/">
        CK8S Kubespray
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../release-notes/postgres/">
        CK8S PostgreSQL
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../release-notes/rabbitmq/">
        CK8S RabbitMQ
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../release-notes/redis/">
        CK8S Redis
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../release-notes/jaeger/">
        CK8S Jaeger
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../release-notes/argocd/">
        CK8S Argo CD
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../glossary/">
        Glossary
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../roadmap/">
        Roadmap
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="https://elastisys.com/">
        Support
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="https://elastisys.com/training/">
        Training
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="https://elastisys.com/blog/">
        Blog
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="https://elastisys.com/legal/privacy-policy/">
        Privacy Policy
      </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#private-network">
    Private Network
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#private-dns">
    Private DNS
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ingress">
    Ingress
  </a>
<nav aria-label="Ingress" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#running-example">
    Running Example
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#letsencrypt">
    LetsEncrypt
  </a>
<nav aria-label="LetsEncrypt" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#issuing-a-certificate">
    Issuing a Certificate
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#lets-encrypt-environments">
    Let's Encrypt Environments
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rate-limits">
    Rate Limits
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#demarcation-of-responsibilities">
    Demarcation of Responsibilities
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#further-reading">
    Further Reading
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<nav class="md-tags">
<a class="md-tag" href="../../ciso-guide/controls/iso-27001/#iso-27001-a1012-key-management">ISO 27001 A.10.1.2 Key Management</a>
<a class="md-tag" href="../../ciso-guide/controls/iso-27001/#iso-27001-a131-network-security">ISO 27001 A.13.1 Network Security</a>
<a class="md-tag" href="../../ciso-guide/controls/bsi-it-grundschutz/#bsi-it-grundschutz-app44a7">BSI IT-Grundschutz APP.4.4.A7</a>
<a class="md-tag" href="../../ciso-guide/controls/bsi-it-grundschutz/#bsi-it-grundschutz-app44a18">BSI IT-Grundschutz APP.4.4.A18</a>
<a class="md-tag" href="../../ciso-guide/controls/hipaa/#hipaa-s52-transmission-164312e1">HIPAA S52 - Transmission - § 164.312(e)(1)</a>
<a class="md-tag" href="../../ciso-guide/controls/hipaa/#hipaa-s53-transmission-security-integrity-controls-164312e2i">HIPAA S53 - Transmission Security - Integrity Controls - § 164.312(e)(2)(i)</a>
<a class="md-tag" href="../../ciso-guide/controls/hipaa/#hipaa-s54-transmission-security-encryption-164312e2ii">HIPAA S54 - Transmission Security - Encryption - § 164.312(e)(2)(ii)</a>
<a class="md-tag" href="../../ciso-guide/controls/msbfs-20207/#msbfs-20207-4-kap-1">MSBFS 2020:7 4 kap. 1 §</a>
<a class="md-tag" href="../../ciso-guide/controls/msbfs-20207/#msbfs-20207-4-kap-2">MSBFS 2020:7 4 kap. 2 §</a>
<a class="md-tag" href="../../ciso-guide/controls/msbfs-20207/#msbfs-20207-4-kap-7">MSBFS 2020:7 4 kap. 7 §</a>
<a class="md-tag" href="../../ciso-guide/controls/hslf-fs-201640/#hslf-fs-201640-3-kap-15-behandling-av-personuppgifter-i-oppna-nat">HSLF-FS 2016:40 3 kap. 15 § Behandling av personuppgifter i öppna nät</a>
</nav>
<h1 id="network-model">Network Model<a class="headerlink" href="#network-model" title="Permanent link">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section helps you implement ISO 27001, specifically:</p>
<ul>
<li>A.10.1.2 Key Management</li>
<li>A.13.1.1 Network Controls</li>
<li>A.13.1.2 Security of Network Services</li>
<li>A.13.1.3 Segregation in Networks</li>
</ul>
</div>
<p><img alt="Compliant Kubernetes Network Model" src="../img/network-model.drawio.svg"/></p>
<p>The diagram above present a useful model when reasoning about networking in Compliant Kubernetes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is just a <strong>model</strong> and not an architectural diagram. Under the hood, things are a lot more complicated.</p>
</div>
<h2 id="private-network">Private Network<a class="headerlink" href="#private-network" title="Permanent link">¶</a></h2>
<p>Your application Pods, as well as Pods of <a href="../additional-services/">additional services</a>, can communicate on a secure private network, via <a href="https://datatracker.ietf.org/doc/html/rfc1918">RFC1918</a> private IP addresses. It is analogous to a <a href="https://en.wikipedia.org/wiki/Virtual_private_cloud">VPC</a> in VM-based workloads.</p>
<p>In Compliant Kubernetes, it is the responsibility of the administrator to ensure the in-cluster private network is secure and trusted, either by performing an <a href="../../operator-manual/provider-audit/">infrastructure audit</a> or deploying <a href="https://elastisys.com/redundancy-across-data-centers-with-kubernetes-wireguard-and-rook/">Pod-to-Pod encryption</a>.</p>
<p>You should use NetworkPolicies to segregate your Pods. This improves your security posture by reducing the blast radius in case parts of your application are under attack.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Feel free to take inspiration from the <a href="https://github.com/elastisys/compliantkubernetes/blob/main/user-demo/deploy/ck8s-user-demo/templates/networkpolicy.yaml">user demo</a>.</p>
<p>More example recipes for Kubernetes Network Policies that you can just copy paste can be found <a href="https://github.com/ahmetb/kubernetes-network-policy-recipes">here</a>.</p>
</div>
<h2 id="private-dns">Private DNS<a class="headerlink" href="#private-dns" title="Permanent link">¶</a></h2>
<p>The private network also features a private DNS. A Service <code>my-svc</code> in the namespace <code>my-namespace</code> can be accessed from within the Kubernetes cluster as <code>my-svc.my-namespace</code>.</p>
<p>IP addresses of Pods are not stable. For example, the rollout of a new container image creates new Pods, which will have new IP addresses. Therefore, you should always use private DNS names of Services to connect your application Pods, as well as to connect your application to <a href="../additional-services/">additional services</a>.</p>
<h2 id="ingress">Ingress<a class="headerlink" href="#ingress" title="Permanent link">¶</a></h2>
<p>Your End Users should never ever access the private network directly. Instead external access is enabled by creating Ingress objects. Compliant Kubernetes already comes with cert-manager and is already configured with a ClusterIssuer. A secure ACME protocol is used to issue and rotate certificates using the <a href="https://letsencrypt.org/">LetsEncrypt</a> public service.</p>
<p>Assuming you configured a Service and a Deployment for you application, making End Users access your application involves two steps:</p>
<ol>
<li>Create the right DNS CNAME record.</li>
<li>Create the right Ingress resource.</li>
</ol>
<h3 id="running-example">Running Example<a class="headerlink" href="#running-example" title="Permanent link">¶</a></h3>
<p>Let us assume you want to host your application behind the nicely branded domain <code>demo.example.com</code>. Proceed as follows:</p>
<p>For step 1, create a DNS CNAME as follows:</p>
<div class="highlight"><pre><span></span><code>demo.example.com. 900 CNAME app.$DOMAIN.
</code></pre></div>
<p>where <code>$DOMAIN</code> is the environment-specific variable <a href="../prepare/#access-your-web-portals">you received from the administrator</a>. The line above is presented in <a href="https://en.wikipedia.org/wiki/Zone_file">DNS Zone file</a> format and is widely accepted by DNS providers.</p>
<p>After configuration, make sure the DNS record is properly configured and propagaged, by typing:</p>
<div class="highlight"><pre><span></span><code>host<span class="w"> </span>-a<span class="w"> </span>demo.example.com.
</code></pre></div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>In the above examples, the domain name is <a href="https://en.wikipedia.org/wiki/Fully_qualified_domain_name">fully qualified</a>, i.e., it ends with a dot. Make sure your DNS provider does not mis-interpret it as a relative domain name. Otherwise, you risk creating a DNS record like <code>demo.example.com.example.com</code> which is rarely what you want.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Be cautious when using CNAMEs and apex domains (e.g., <code>example.com</code>). See <a href="https://serverfault.com/questions/613829/why-cant-a-cname-record-be-used-at-the-apex-aka-root-of-a-domain">here</a> for a long discussion of potential problems and current workarounds.</p>
</div>
<p>For step 2, create an Ingress object with the right <code>metadata.annotations</code> and <code>spec.tls</code>, as exemplified below:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp-ck8s-user-demo</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># To list your current ClusterIssuers, simply use 'kubectl get ClusterIssuers'.</span>
<span class="w">    </span><span class="nt">cert-manager.io/cluster-issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span>
<span class="w">    </span><span class="nt">kubernetes.io/ingress.class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">    </span><span class="c1">## Uncomment the line below to implement source IP allowlisting.</span>
<span class="w">    </span><span class="c1">## Blocklisted IPs will get HTTP 403.</span>
<span class="w">    </span><span class="c1"># nginx.ingress.kubernetes.io/whitelist-source-range: 98.128.193.2/32</span>
<span class="w">    </span><span class="c1">## Uncomment the lines below to get OAuth authentication</span>
<span class="w">    </span><span class="c1">## You will also need to configure and install oauth2-proxy.</span>
<span class="w">    </span><span class="c1">## For an example and more details, see https://github.com/elastisys/compliantkubernetes/blob/main/user-demo/deploy/oauth2-proxy.yaml</span>
<span class="w">    </span><span class="c1"># nginx.ingress.kubernetes.io/auth-url: "https://$host/oauth2/auth"</span>
<span class="w">    </span><span class="c1"># nginx.ingress.kubernetes.io/auth-signin: "https://$host/oauth2/start?rd=$escaped_request_uri"</span>
<span class="w">    </span><span class="c1"># nginx.ingress.kubernetes.io/auth-response-headers: "authorization"</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="s">"demo.example.com"</span>
<span class="w">      </span><span class="nt">http</span><span class="p">:</span>
<span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">              </span><span class="nt">service</span><span class="p">:</span>
<span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp-ck8s-user-demo</span>
<span class="w">                </span><span class="nt">port</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3000</span>
<span class="w">  </span><span class="nt">tls</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"demo.example.com"</span>
<span class="w">      </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">demo.example.com-tls</span>
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Feel free to take inspiration from the <a href="https://github.com/elastisys/compliantkubernetes/blob/main/user-demo/deploy/ck8s-user-demo/values.yaml#L34">user demo</a>.</p>
<p>If you want to protect your Ingress with OAuth2-based authentication, check out <a href="https://github.com/elastisys/compliantkubernetes/blob/main/user-demo/deploy/oauth2-proxy.yaml">oauth2-proxy</a>.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The DNS name in <code>spec.rules[0].host</code> and <code>spec.tls[0].hosts[0]</code> must be the same as the DNS entry used by your End Users, in the example above <code>demo.example.com</code>. Otherwise, the End Users will get a "Your connection is not private" error.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Some load-balancers fronting Compliant Kubernetes do not preserve source IP. This makes source IP allowlisting unusable.</p>
<p>To check if source IP is preserved, check the HTTP request headers received by your application, specifically <code>x-forwarded-for</code> and <code>x-real-ip</code>. The <a href="https://github.com/elastisys/compliantkubernetes/blob/main/user-demo/app.js#L24">user demo</a> logs all HTTP request headers, as shown in the screenshot below.</p>
<p><img alt="HTTP request headers shown in the user demo" src="../img/http-request-headers.png"/></p>
</div>
<h2 id="letsencrypt">LetsEncrypt<a class="headerlink" href="#letsencrypt" title="Permanent link">¶</a></h2>
<p>Let’s Encrypt is a certificate authority that provides free SSL/TLS certificates via an automated process. Their certificates are accepted by most of today’s browsers.</p>
<p>On Compliant Kubernetes, we provide a cert-manager setup which you can use to create, sign, install and renew certificates for your domains/apps running in CK8S.</p>
<h3 id="issuing-a-certificate">Issuing a Certificate<a class="headerlink" href="#issuing-a-certificate" title="Permanent link">¶</a></h3>
<p>You can use cert-manager setup for general purpose certificates not directly linked to an Ingress object.</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cert-manager.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Certificate</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">custom-cert</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">dnsNames</span><span class="p">:</span><span class="w"> </span><span class="c1"># (1)</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">'domain.example.com'</span>
<span class="w">  </span><span class="nt">issuerRef</span><span class="p">:</span><span class="w"> </span><span class="c1"># (2)</span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIssuer</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span>
<span class="w">  </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">custom-cert</span><span class="w"> </span><span class="c1"># (3)</span>
</code></pre></div>
<ol>
<li>For which domains the certificate will be valid for.</li>
<li>Reference to the issuer to use.</li>
<li>The created certificate is stored in this secret.</li>
</ol>
<p>And you can directly link a certificate to an Ingress object :</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cert-manager.io/cluster-issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span><span class="w"> </span><span class="c1"># (1)</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webapp-ingress</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span><span class="w"> </span><span class="c1"># (2)</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example.com</span>
<span class="w">    </span><span class="nt">http</span><span class="p">:</span>
<span class="w">      </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="w">        </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">          </span><span class="nt">service</span><span class="p">:</span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myservice</span>
<span class="w">            </span><span class="nt">port</span><span class="p">:</span>
<span class="w">              </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">  </span><span class="nt">tls</span><span class="p">:</span><span class="w"> </span><span class="c1"># (3)</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example.com</span>
<span class="w">    </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webapp-certificate</span><span class="w"> </span><span class="c1"># (4)</span>
</code></pre></div>
<ol>
<li>Annotation indicating the issuer to use.</li>
<li>Target namespace where the object will be created.</li>
<li>Placing a host in the TLS config will determine what ends up in the cert’s subjectAltNames.</li>
<li>The created certificate is stored in this secret.</li>
</ol>
<h3 id="lets-encrypt-environments">Let's Encrypt Environments<a class="headerlink" href="#lets-encrypt-environments" title="Permanent link">¶</a></h3>
<p>LetsEncrypt provides two environments as part of their ACME V2 standardization: Staging &amp; Production.</p>
<p>The ACME URL for LetsEncrypt ACME v2 staging environment is: https://acme-staging-v02.api.letsencrypt.org/directory</p>
<p>The ACME URL for LetsEncrypt ACME v2 production environment is: https://acme-v02.api.letsencrypt.org/directory</p>
<p>Both environments serve to issue valid certificates, the difference is the CA, on staging, the CA is not trusted by any application, web browser ..</p>
<p>We highly recommend testing against the Let’s Encrypt staging environment and use it for any non-production workloads. This will allow you to get things right before issuing trusted certificates and reduce the chance of you running up against rate limits. It should be to test that your client is working fine and can generate the challenges, certificates…</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Certificates issued by the LetsEncrypt staging environment are signed by untrusted authorities, similar to self-signed certificates. They are typically not used in production environments.</p>
</div>
<h3 id="rate-limits">Rate Limits<a class="headerlink" href="#rate-limits" title="Permanent link">¶</a></h3>
<p>LetsEncrypt provides rate-limits on generated certificates to ensure fair usage across all clients. The production environment limits can be exceeded more frequently in environments certificates are installed or reinstalled frequently. This can result in failed installations due to rate limit exceptions on certificate generation.</p>
<p>In such environments, it is better to use the LetsEncrypt staging environment, which has much higher limits than the production environment.</p>
<p>The default rate limits for the production environment are listed in the following page by letencrypt : <a href="https://letsencrypt.org/docs/rate-limits/">Production Rate Limits</a>.</p>
<p>The staging environment uses the same rate limits as described for the production environment with some exceptions that are listed here : <a href="https://letsencrypt.org/docs/staging-environment/">Staging Rate Limits</a>.</p>
<h2 id="demarcation-of-responsibilities">Demarcation of Responsibilities<a class="headerlink" href="#demarcation-of-responsibilities" title="Permanent link">¶</a></h2>
<p>You are responsible for:</p>
<ul>
<li>creating Pods (via Deployments), Service and Ingress;</li>
<li>segregating the private network via NetworkPolicies;</li>
<li>configuring Ingresses as required to enable HTTPS encryption.</li>
</ul>
<p>The <a href="https://github.com/elastisys/compliantkubernetes/tree/main/user-demo/deploy/ck8s-user-demo">user demo</a> already showcases the above.</p>
<p>The Compliant Kubernetes administrator is responsible for:</p>
<ul>
<li>ensuring cert-manager works and is configured correctly;</li>
<li>ensuring ClusterIssuers exist and are configured correctly;</li>
<li>ensure the private network is secure or trusted.</li>
</ul>
<h2 id="further-reading">Further Reading<a class="headerlink" href="#further-reading" title="Permanent link">¶</a></h2>
<ul>
<li><a href="https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/">DNS for Services and Pods</a></li>
<li><a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">Ingress</a></li>
<li><a href="https://kubernetes.io/docs/concepts/services-networking/network-policies/">NetworkPolicies</a></li>
</ul>
</article>
</div>
<script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg>
            Back to top
          </button>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: Continous Development" class="md-footer__link md-footer__link--prev" href="../continous-development/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                Previous
              </span>
<div class="md-ellipsis">
                Continous Development
              </div>
</div>
</a>
<a aria-label="Next: Kubernetes API" class="md-footer__link md-footer__link--next" href="../kubernetes-api/" rel="next">
<div class="md-footer__title">
<span class="md-footer__direction">
                Next
              </span>
<div class="md-ellipsis">
                Kubernetes API
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © Elastisys AB <br/> The Linux Foundation has the following registered trademarks in the United States and/or other countries: Certified Kubernetes®, containerd®, fluentd®, Helm®, Istio®, K8s®, Kubernetes®, Prometheus®, PromQL®, Rook®, The Linux Foundation®. <br/> The Linux Foundation has registrations pending or trademarks in use for the following marks in the United States and/or other countries: Argo™, CoreDNS™, Falco™, Harbor™, Jaeger™, Linux Foundation™, OpenTelemetry™, OpenTracing™, Open Policy Agent™, Tekton™, Thanos™. <br/> Postgres and PostgreSQL and the Elephant Logo (Slonik) are all registered trademarks of the PostgreSQL Community Association of Canada. <br/> Redis is a trademark of Redis Ltd. Any rights therein are reserved to Redis Ltd. Any use by the Compliant Kubernetes project is for referential purposes only and does not indicate any sponsorship, endorsement or affiliation between Redis and Compliant Kubernetes project. <br/> RabbitMQ is a trademark of VMware, Inc. in the U.S. and other countries. <br/> TimescaleDB and the EON mascot are trademarks of <a href="https://www.timescale.com/">Timescale, Inc.</a> <br/> FerretDB® is a registered trademark of FerretDB, Inc. FerretDB Inc. is not affiliated, associated, authorized, endorsed by, or in any way officially connected with MongoDB Inc., or any of its subsidiaries or its affiliates. <br/> MongoDB, Mongo, and the leaf logo are registered trademarks of MongoDB, Inc. <br/> Keycloak™ is a trademark of Red Hat Inc. <br/> OpenSearch is a registered trademark of Amazon Web Services. <br/> NGINX is a registered trademark of F5 Inc.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "content.code.copy", "content.tabs.link", "navigation.footer", "navigation.top"], "search": "../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
<script src="../../assets/javascripts/bundle.220ee61c.min.js"></script>
</body>
</html>